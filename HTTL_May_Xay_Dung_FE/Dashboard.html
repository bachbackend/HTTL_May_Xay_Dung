<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="Responsive Admin &amp; Dashboard Template based on Bootstrap 5">
	<meta name="author" content="AdminKit">
	<meta name="keywords" content="adminkit, bootstrap, bootstrap 5, admin, dashboard, template, responsive, css, sass, html, theme, front-end, ui kit, web">

	<link rel="preconnect" href="https://fonts.gstatic.com">
	<link rel="shortcut icon" href="./dashboard/img/icons/icon-48x48.png" />

	<!-- <link rel="canonical" href="Dashboard.html" /> -->

	<title>Dashboard</title>

	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&amp;display=swap" rel="stylesheet">

	<!-- Choose your prefered color scheme -->
	<!-- <link href="css/light.css" rel="stylesheet"> -->
	<!-- <link href="css/dark.css" rel="stylesheet"> -->

	<!-- BEGIN SETTINGS -->
	<!-- Remove this after purchasing -->
	<link class="js-stylesheet" href="./dashboard/css/light.css" rel="stylesheet">
	<!-- <script src="./dashboard/js/settings.js"></script>
	<style>body {
			opacity: 0;
		}
	</style> -->
	<!-- END SETTINGS -->
<!-- <script async src="https://www.googletagmanager.com/gtag/js?id=UA-120946860-10"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-120946860-10', { 'anonymize_ip': true });
</script> -->
</head>
<!--
  HOW TO USE: 
  data-theme: default (default), dark, light, colored
  data-layout: fluid (default), boxed
  data-sidebar-position: left (default), right
  data-sidebar-layout: default (default), compact
-->

<body data-theme="default" data-layout="fluid" data-sidebar-position="left" data-sidebar-layout="default">
	<div class="wrapper">
		<nav id="sidebar" class="sidebar js-sidebar">
			<div class="sidebar-content js-simplebar">
				<a class="sidebar-brand" href="Dashboard.html">
					<span class="sidebar-brand-text align-middle">
						Machine Max
						<sup><small class="badge bg-primary text-uppercase">Pro</small></sup>
					</span>
					<svg class="sidebar-brand-icon align-middle" width="32px" height="32px" viewBox="0 0 24 24" fill="none" stroke="#FFFFFF" stroke-width="1.5"
						stroke-linecap="square" stroke-linejoin="miter" color="#FFFFFF" style="margin-left: -3px">
						<path d="M12 4L20 8.00004L12 12L4 8.00004L12 4Z"></path>
						<path d="M20 12L12 16L4 12"></path>
						<path d="M20 16L12 20L4 16"></path>
					</svg>
				</a>

				<div class="sidebar-user">
					<div class="d-flex justify-content-center">
						<div class="flex-shrink-0">
							<img src="./dashboard/img/avatars/avatar.jpg" class="avatar img-fluid rounded me-1" alt="Charles Hall" />
						</div>
						<div class="flex-grow-1 ps-2" id="user-profile-section">
							<a class="sidebar-user-title dropdown-toggle" href="#" data-bs-toggle="dropdown" id="user-name">
							</a>
							<div class="dropdown-menu dropdown-menu-start">
								<a class="dropdown-item" id="open-profile"><i class="align-middle me-1" data-feather="user"></i> Profile</a>
								<a class="dropdown-item" href="#" id="logout-button">Log out</a>

							</div>
						
							<div class="sidebar-user-subtitle" id="user-role"></div>
						</div>
						
					</div>
				</div>

				<ul class="sidebar-nav">
					<li class="sidebar-item">
						<a class="sidebar-link" href="Product-Management.html" target="_blank">
							<i class="align-middle" data-feather="box"></i> <span class="align-middle">Quản lý sản phẩm</span>
						</a>
					</li>

					<li class="sidebar-item">
						<a class="sidebar-link" href="Article-Management.html" target="_blank">
							<i class="align-middle" data-feather="edit"></i> <span class="align-middle">Quản lý bài viết</span>
						</a>
					</li>

					<li class="sidebar-item">
						<a class="sidebar-link" href="Contact-Management.html"target="_blank">
							<i class="align-middle" data-feather="user"></i> <span class="align-middle">Quản lý liên hệ</span>
						</a>
					</li>

					<li class="sidebar-item">
						<a class="sidebar-link" href="Order-Management.html" target="_blank">
							<i class="align-middle" data-feather="shopping-cart"></i> <span class="align-middle">Quản lý đơn hàng</span>
						</a>
					</li>

					<li class="sidebar-item">
						<a class="sidebar-link" href="#">
							<i class="align-middle" data-feather="calendar"></i> <span class="align-middle">Calendar1</span>
							<span class="sidebar-badge badge bg-primary">Pro</span>
						</a>
					</li>

					<li class="sidebar-item">
						<a class="sidebar-link" href="#">
							<i class="align-middle" data-feather="calendar"></i> <span class="align-middle">Calendar2</span>
							<span class="sidebar-badge badge bg-primary">Pro</span>
						</a>
					</li>


					
				</ul>

				
			</div>

			<script>
				document.getElementById("logout-button").addEventListener("click", function () {
					// Xóa thông tin người dùng khỏi localStorage
					localStorage.removeItem("accesstoken");
			
					// Có thể xóa thêm token hoặc dữ liệu liên quan nếu có
					// localStorage.removeItem("authToken");
			
					// Chuyển hướng đến trang đăng nhập
					window.location.href = "Login.html"; // Thay bằng đường dẫn đúng tới trang đăng nhập của bạn
				});
			</script>
			
		</nav>

		<div class="main">
			<nav class="navbar navbar-expand navbar-light navbar-bg">
				<a class="sidebar-toggle js-sidebar-toggle">
					<i class="hamburger align-self-center"></i>
				</a>

				<form class="d-none d-sm-inline-block">
					<div class="input-group input-group-navbar">
						<input type="text" class="form-control" placeholder="Search…" aria-label="Search">
						<button class="btn" type="button">
							<i class="align-middle" data-feather="search"></i>
						</button>
					</div>
				</form>

			</nav>

			<main class="content">
				<div class="container-fluid p-0">

					<div class="row mb-2 mb-xl-3">
						<div class="col-auto d-none d-sm-block">
							<h3><strong>Analytics</strong> Dashboard</h3>
						</div>
					</div>
					<div class="row">
						<div class="col-xl-6 col-xxl-5 d-flex">
							<div class="w-100">
								<div class="row">
									<div class="col-sm-6">
										<div class="card">
											<div class="card-body">
												<div class="row">
													<div class="col mt-0">
														<h5 class="card-title">Sales</h5>
													</div>

													<div class="col-auto">
														<div class="stat text-primary">
															<i class="align-middle" data-feather="truck"></i>
														</div>
													</div>
												</div>
												<h1 class="mt-1 mb-3">2.382</h1>
												<div class="mb-0">
													<span class="badge badge-primary-light"> <i class="mdi mdi-arrow-bottom-right"></i> -3.65% </span>
													<span class="text-muted">Since last week</span>
												</div>
											</div>
										</div>
										<div class="card">
											<div class="card-body">
												<div class="row">
													<div class="col mt-0">
														<h5 class="card-title">Visitors</h5>
													</div>

													<div class="col-auto">
														<div class="stat text-primary">
															<i class="align-middle" data-feather="users"></i>
														</div>
													</div>
												</div>
												<h1 class="mt-1 mb-3">14.212</h1>
												<div class="mb-0">
													<span class="badge badge-success-light"> <i class="mdi mdi-arrow-bottom-right"></i> 5.25% </span>
													<span class="text-muted">Since last week</span>
												</div>
											</div>
										</div>
									</div>
									<div class="col-sm-6">
										<div class="card">
											<div class="card-body">
												<div class="row">
													<div class="col mt-0">
														<h5 class="card-title">Earnings</h5>
													</div>

													<div class="col-auto">
														<div class="stat text-primary">
															<i class="align-middle" data-feather="dollar-sign"></i>
														</div>
													</div>
												</div>
												<h1 class="mt-1 mb-3">$21.300</h1>
												<div class="mb-0">
													<span class="badge badge-success-light"> <i class="mdi mdi-arrow-bottom-right"></i> 6.65% </span>
													<span class="text-muted">Since last week</span>
												</div>
											</div>
										</div>
										<div class="card">
											<div class="card-body">
												<div class="row">
													<div class="col mt-0">
														<h5 class="card-title">Orders</h5>
													</div>

													<div class="col-auto">
														<div class="stat text-primary">
															<i class="align-middle" data-feather="shopping-cart"></i>
														</div>
													</div>
												</div>
												<h1 class="mt-1 mb-3">64</h1>
												<div class="mb-0">
													<span class="badge badge-danger-light"> <i class="mdi mdi-arrow-bottom-right"></i> -2.25% </span>
													<span class="text-muted">Since last week</span>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>

						<div class="col-xl-6 col-xxl-7">
							<div class="card flex-fill w-100">
								<div class="card-header">
									<div class="float-end">
										<!-- abc -->
									</div>
									<h5 class="card-title mb-0">Tổng quan đơn hàng</h5>
								</div>
								<div class="card-body pt-2 pb-3">
									<div class="chart chart-sm">
										<canvas id="chartjs-dashboard-line"></canvas>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-12 col-md-12 col-xxl-9 d-flex order-3 order-xxl-2">
							<div class="card flex-fill w-100">
								<div class="card-header">
									<div class="card-actions float-end">
										<div class="dropdown position-relative">
											<a href="#" data-bs-toggle="dropdown" data-bs-display="static">
												<i class="align-middle" data-feather="more-horizontal"></i>
											</a>

											<div class="dropdown-menu dropdown-menu-end">
												<a class="dropdown-item" href="#">Action</a>
												<a class="dropdown-item" href="#">Another action</a>
												<a class="dropdown-item" href="#">Something else here</a>
											</div>
										</div>
									</div>
									<h5 class="card-title mb-0">Tình trạng sản phẩm </h5>
								</div>
							</div>
						</div>
						<div class="col-12 col-md-6 col-xxl-3 d-flex order-2 order-xxl-1">
							<div class="card flex-fill">
								<div class="card-header">
									<div class="card-actions float-end">
										<div class="dropdown position-relative">
											<a href="#" data-bs-toggle="dropdown" data-bs-display="static">
												<i class="align-middle" data-feather="more-horizontal"></i>
											</a>

											<div class="dropdown-menu dropdown-menu-end">
												<a class="dropdown-item" href="#">Action</a>
												<a class="dropdown-item" href="#">Another action</a>
												<a class="dropdown-item" href="#">Something else here</a>
											</div>
										</div>
									</div>
									<h5 class="card-title mb-0">Calendar</h5>
								</div>
								<div class="card-body d-flex">
									<div class="align-self-center w-100">
										<div class="chart">
											<div id="datetimepicker-dashboard"></div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

			</main>

		</div>
	</div>
    <script>
		document.addEventListener("DOMContentLoaded", function() {
			var date = new Date(Date.now());
			var defaultDate = date.getUTCFullYear() + "-" + (date.getUTCMonth() + 1) + "-" + date.getUTCDate();
			document.getElementById("datetimepicker-dashboard").flatpickr({
				inline: true,
				prevArrow: "<span class=\"fas fa-chevron-left\" title=\"Previous month\"></span>",
				nextArrow: "<span class=\"fas fa-chevron-right\" title=\"Next month\"></span>",
				defaultDate: defaultDate
			});
		});
	</script>

<script>
	let currentUser = null;

	document.addEventListener("DOMContentLoaded", async function () {

		function getUserIdFromToken() {
        const token = localStorage.getItem("accesstoken");
        if (!token) {
            console.warn("Không có token");
            return null;
        }

        try {
            const payload = JSON.parse(atob(token.split(".")[1]));
            return payload.nameid;
        } catch (error) {
            console.error("Lỗi khi giải mã token:", error);
            return null;
        }
    }

		const userId = getUserIdFromToken(); // Lấy từ localStorage

		if (!userId) {
			console.error("Không tìm thấy userId trong localStorage.");
			window.location.href = "/Login.html";
			return;
		}

		try {
			const res = await fetch(`https://localhost:7205/api/Profile/Profile/${userId}`);
			if (!res.ok) throw new Error("Không thể tải thông tin người dùng");

			const user = await res.json();
			currentUser = user;

			// Kiểm tra quyền truy cập dashboard
			if (window.location.pathname.includes("Dashboard.html") && user.role !== 0 && user.role !== 2) {
				alert("Bạn không có quyền truy cập vào trang này.");
				window.location.href = "/Home.html"; // Chuyển hướng về trang chủ hoặc trang phù hợp
				return;
			}

			// Gán tên và vai trò vào UI
			document.getElementById("user-name").textContent = user.username;
			document.getElementById("user-role").textContent = mapRoleToText(user.role);
		} catch (err) {
			console.error("Lỗi khi lấy thông tin người dùng:", err);
			window.location.href = "/Login.html";
		}
	});

	// Khi click "Profile"
	document.getElementById("open-profile").addEventListener("click", function () {
		if (!currentUser) return;

		document.getElementById("modal-username").textContent = currentUser.username;
		document.getElementById("modal-email").textContent = currentUser.email;
		document.getElementById("modal-phone").textContent = currentUser.phonenumber;
		document.getElementById("modal-role").textContent = mapRoleToText(currentUser.role);
		document.getElementById("modal-lastlogin").textContent = currentUser.lastLogin
			? new Date(currentUser.lastLogin).toLocaleString()
			: "Chưa đăng nhập";

		const modal = new bootstrap.Modal(document.getElementById("userProfileModal"));
		modal.show();
	});

	function mapRoleToText(role) {
		switch (role) {
			case 0: return "Admin";
			case 1: return "Khách hàng";
			case 2: return "Manager";
			default: return "Không rõ";
		}
	}
	
</script>




	<script src="./dashboard/js/app.js"></script>


	<!-- Modal thông tin người dùng -->
<div class="modal fade" id="userProfileModal" tabindex="-1" aria-labelledby="userProfileModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered">
	  <div class="modal-content">
		<div class="modal-header">
		  <h5 class="modal-title" id="userProfileModalLabel">Thông tin người dùng</h5>
		  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
		</div>
		<div class="modal-body">
		  <p><strong>Tên:</strong> <span id="modal-username"></span></p>
		  <p><strong>Email:</strong> <span id="modal-email"></span></p>
		  <p><strong>Số điện thoại:</strong> <span id="modal-phone"></span></p>
		  <p><strong>Vai trò:</strong> <span id="modal-role"></span></p>
		  <p><strong>Lần đăng nhập cuối:</strong> <span id="modal-lastlogin"></span></p>
		</div>
	  </div>
	</div>
  </div>
  
</body>

</html>